#! /bin/bash
set -e

# Run regularly - perhaps every Friday - to update Public Whip site in full.

# TODO: Add cluster diagram generation
# TODO: Add raw data CSV exporting

#FROMDATE=2001-06-01
FROMDATE=2004-01-01 # until Julian sorts out gid replacing

echo "Updating from CVS"
cvs -Q update -dP

echo "Scraping new divisions"
cd pyscraper
./lazyrunall.py --from $DATE scrape parse debates
cd ..
cd loader
./load.pl --from=$FROMDATE divsxml check calc
cd ..

echo "Getting dynamic tables for backup"
build/getdb

echo "Uploading new division database"
build/upload-db

echo "Done"

