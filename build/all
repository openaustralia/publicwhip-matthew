#! /bin/bash
set -e

# Run regularly - perhaps every Friday - to update Public Whip site in full.

# TODO: Add cluster diagram generation
# TODO: Add raw data CSV exporting

echo "Updating from CVS"
cvs -Q update -dP

echo "Scraping new divisions"
cd scraper
./scrape.pl months content divisions check calc
cd ..

echo "Scraping new written answers"
cd pyscraper
./lazyrunall.py --from 2003-01-01 --network --wrans 
cd ..

echo "Getting dynamic tables for backup"
build/getdb

echo "Making wrans indices"
cd pyindex
./protoidindex.py
./protoindex.py
cd ..

echo "Upload XML files"
build/upload-xml

echo "Uploading new division database"
build/upload-db

echo "Done"

