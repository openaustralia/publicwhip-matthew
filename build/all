#! /bin/bash
set -e

# Run regularly - perhaps every Friday - to update Public Whip site in full.

# TODO: Add cluster diagram generation
# TODO: Add raw data CSV exporting

echo "Updating from CVS"
cvs -Q update -dP

echo "Scraping new divisions"
cd pyscraper
./lazyrunall.py --from 2001-06-01 scrape parse debates
cd ..
cd loader
./load.pl divsxml check calc
cd ..

#echo "Scraping new written answers"
#cd pyscraper
#./lazyrunall.py --from 2001-06-01 scrape parse wrans 
#cd ..

echo "Getting dynamic tables for backup"
build/getdb

#echo "Making wrans indices"
#cd pyindex
#./protoidindex.py
#./protoindex.py
#cd ..

#echo "Upload XML files"
#build/upload-xml

echo "Uploading new division database"
build/upload-db

echo "Done"

